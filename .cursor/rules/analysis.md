# 知识卡片与剧情树分析规范 (Analysis)

## 目标
- 从小说章节正文中提取 **知识卡片**（人物、设定、事件等），并构建 **剧情树**（PlotNode 关系）。

## 数据模型
- **PlotNode**：剧情节点，可表示场景、事件、角色决策等，含唯一 id、类型、摘要、关联章节等。
- **KnowledgeCard**：知识卡片，结构化 JSON，包含但不限于：
  - 类型（人物 / 地点 / 物品 / 设定 / 事件）
  - 名称、描述、首次出现章节、关联剧情节点 id 等。

## 提取逻辑
- **extractor.py**：调用 LLM，对给定章节或段落做 NER/摘要，输出符合 KnowledgeCard 与 PlotNode 的结构化结果。
- 提示词与输出格式需与 **models.py** 中的 Pydantic 模型一致，便于校验与入库。

## 剧情树
- **plot_tree.py**：维护节点父子/先后关系，支持按章节或时间线挂载节点，为后续检索与 RAG 提供结构。

## 输入输出
- 输入：来自 **data/raw** 的章节 JSON（含 `chapter_title`、`content`）。
- 输出：知识卡片写入 **data/cards**（JSON），剧情树关系可落库或与向量库元数据关联。
